<?xml version="1.0" encoding="UTF-8"?>
<proxy name="FileUploadProxyService" startOnLoad="true" transports="http https" xmlns="http://ws.apache.org/ns/synapse">
    <target>
        <inSequence>
            <script language="js"><![CDATA[var file = mc.getAttachment("file");
    var fileName = file.getHeader("Content-Disposition").split("filename=")[1].replace(/"/g, "");
    var fileData = new String(file.getDataSource().getData());
    
    mc.setProperty("FILE_NAME", fileName);
    mc.setProperty("FILE_DATA", fileData);

    log.info("Received file: " + fileName);]]></script>
            <log level="custom">
                <property expression="get-property('FILE_NAME')" name="File Name"/>
                <property expression="get-property('FILE_DATA')" name="File Data"/>
            </log>
        </inSequence>
        <outSequence>
            <log level="full"/>
            <send/>
        </outSequence>
        <faultSequence/>
    </target>
</proxy>
